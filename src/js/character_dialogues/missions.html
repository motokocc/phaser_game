<!DOCTYPE html>
<html>
<body>
	<p id="demo"></p>

	<div class='missions'></div>

<script>
let missions = [
	{
		title: 'Goblin Extermination',
		description: 'Exterminate 5 goblins',
		requiredLevel: 5,
		condition: {
			task: 'kill',
			enemy: 'goblin',
			amountNeed: 5,
		}
	},
	{
		title: 'Kill Goblin Lord',
		description: 'Exterminate goblin lord',
		requiredLevel: 10,
		condition: {
			task: 'kill',
			enemy: 'goblin lord',
			amountNeed: 3,
		}
	},
	{
		title: 'Kill Slime King',
		description: 'Exterminate Slime King',
		requiredLevel: 20,
		condition: {
			task: 'kill',
			enemy: 'Slime king',
			amountNeed: 1,
		}
	},	
]

let playerInfo = {
	level: 20,
    missions: {
    	finished: ['Goblin Extermination', 'Kill Goblin Lord', 'Kill Slime King'],
       	currentMission: null	
    }
}

class Mission{

	constructor(playerLevel){
		this.playeLevel = playerLevel
		this.allowedMissions = [];
	}

	generateMissions(){
		missions.forEach(mission => {
			if(this.playeLevel >= mission.requiredLevel){
				this.allowedMissions.push(mission);
			}
		});

		return this.allowedMissions;
	}

	takeMission(missionsCompleted){
		let allMissions = this.generateMissions();

		if(missionsCompleted){
			let filteredMission = allMissions.filter(mission => !missionsCompleted.includes(mission.title));

			if(filteredMission.length >= 1){
				return filteredMission[0];
			}
			else{
				return null;
			}
		}
		else{
			return allMissions[0];
		}
    }
};

let quest = new Mission(playerInfo.level);

let npc_message = document.querySelector('#demo');
let missionCointainer = document.querySelector('.missions');

let missionsToTake = quest.generateMissions();

if(playerInfo.level < 5){
	npc_message.innerHTML = 'Come back when you are at least level 5'
}
else if(missionsToTake.length >= 1){
	if(playerInfo.missions.currentMission){
		let { progress, condition } = playerInfo.missions.currentMission;

		if(progress >= condition.amountNeed){
    		npc_message.innerHTML = 'Mission Complete. Please take this.'

    		let missionCompleteButton = document.createElement('button');
    		missionCompleteButton.innerHTML = 'OK';
    		missionCompleteButton.onclick = function () {
    			playerInfo.missions.finished.push(playerInfo.missions.currentMission.title);
			    playerInfo.missions.currentMission = null;
    			npc_message.innerHTML = 'Thank you for completing the mission. Comeback again later for more quest'
			};

			missionCointainer.append(missionCompleteButton);
		}
		else{
    		npc_message.innerHTML = `You still haven't completed the mission yet`;
		}
    }
    else{
    	//FIRST QUEST
    	if(playerInfo.missions.finished.length <= 0){
    		let firstQuest = quest.takeMission();
    		npc_message.innerHTML = `Your first mission is ${firstQuest.title}. Will you accept the mission?`;

    		let buttonFirstQuest = document.createElement('button');
    		buttonFirstQuest.innerHTML = 'OK';
    		buttonFirstQuest.onclick = function () {
    			firstQuest.progress = 0;
			    playerInfo.missions.currentMission = firstQuest;
    			npc_message.innerHTML = `Great! Comeback again later when its done`
			};

    		missionCointainer.append(buttonFirstQuest);
    	}
    	else{
    		let latestQuest = quest.takeMission(playerInfo.missions.finished);

    		if(latestQuest){
	     		npc_message.innerHTML = `Your latest mission is ${latestQuest.title}. Will you accept the mission?`;

	    		let buttonLatestQuest = document.createElement('button');
	    		buttonLatestQuest.innerHTML = 'OK';
	    		buttonLatestQuest.onclick = function () {
	    			latestQuest.progress = 0;
				    playerInfo.missions.currentMission = latestQuest;
	    			npc_message.innerHTML = `Great! Comeback again later when its done`
	    			console.log(playerInfo)
				};

	    		missionCointainer.append(buttonLatestQuest);     			
    		}
  			else{
  				npc_message.innerHTML = 'No missions available at the moment'
  			}
    	}
    }
}
else{
	npc_message.innerHTML = 'No missions available at the moment'
}
</script>

</body>
</html>
